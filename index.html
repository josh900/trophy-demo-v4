<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saginaw Digital Trophy Case</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
    <!-- ðŸš€ Include model-viewer script -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    
    <!-- API Endpoint Detection -->
    <script>
        // Function to detect API Gateway URL based on environment
        function detectApiEndpoint() {
            // IMPORTANT: Set the API Gateway URL manually from AWS
            // We need to use the API Gateway URL from your AWS account
            // Get this URL from the API Gateway console under Stages section
            const apiGatewayUrl = "https://72w9r9ffd8.execute-api.us-east-1.amazonaws.com/Prod";
            window.API_ENDPOINT = apiGatewayUrl;
            console.log('Using hardcoded API Gateway URL:', window.API_ENDPOINT);
            
            // Amplify hosting detection - only attempt in production
            if (window.location.hostname.includes('amplifyapp.com')) {
                try {
                    // First try to get the API URL from the Amplify outputs
                    fetch('/.amplify-hosting/api-info.json')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('API info not available');
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data && data.api && data.api.api && data.api.api.RootUrl) {
                                window.API_ENDPOINT = data.api.api.RootUrl;
                                console.log('API Gateway URL detected from Amplify:', window.API_ENDPOINT);
                            } else {
                                console.log('API Gateway URL not found in amplify outputs, using hardcoded URL');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching API Gateway URL:', error);
                            console.log('Using hardcoded API Gateway URL');
                        });
                } catch (error) {
                    console.error('Error in API detection:', error);
                }
            } else if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                // For local development
                window.API_ENDPOINT = ''; // Use relative paths for local dev
                console.log('Using relative API paths for local development');
            }
        }
        
        // Function to test API healthcheck
        function checkApiHealth() {
            // Don't test health in production - avoid CORS errors in console
            if (window.location.hostname.includes('amplifyapp.com')) {
                console.log('Skipping health check in production to avoid CORS errors');
                return;
            }
            
            // Use the API endpoint for local development only
            fetch(`${window.API_ENDPOINT}/api/healthcheck`)
                .then(response => {
                    if (response.ok) {
                        console.log('API healthcheck successful using:', window.API_ENDPOINT);
                        return response.json();
                    }
                    throw new Error('Healthcheck failed with status: ' + response.status);
                })
                .then(data => {
                    console.log('API response:', data);
                })
                .catch(error => {
                    console.warn('API healthcheck failed:', error);
                    
                    // In local development, try relative path
                    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                        fetch('/api/healthcheck')
                            .then(response => {
                                if (response.ok) {
                                    window.API_ENDPOINT = '';
                                    console.log('Using relative API paths');
                                }
                            })
                            .catch(() => {
                                console.log('Local API server not running');
                            });
                    }
                });
        }
        
        // Run the detection on page load
        detectApiEndpoint();
        
        // Only check API health locally
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            setTimeout(checkApiHealth, 1000);
        }
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <svg class="header-logo" width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 0L25 10H35L27 16L30 26L20 20L10 26L13 16L5 10H15L20 0Z" fill="#EFBF04"/>
            </svg>
            <h1>Saginaw Digital Trophy Case</h1>
        </div>
        <nav id="main-nav">
            <button id="back-button" class="nav-button"><i class="fas fa-arrow-left"></i> Back</button>
            <button id="home-button" class="nav-button"><i class="fas fa-home"></i> Home</button>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search players or teams...">
                <button id="search-button"><i class="fas fa-search"></i></button>
            </div>
        </nav>
    </header>

    <main>
        <!-- Loading Spinner -->
        <div id="loading-spinner">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Main Content Container -->
        <div id="content-container">
            <!-- Views will be dynamically injected here -->
        </div>

        <!-- Schools View Template -->
        <template id="schools-view-template">
            <div class="view-container schools-view">
                <h2 class="view-title">Choose an option</h2>
                <div class="card-grid" id="schools-grid">
                    <!-- School cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- School Card Template -->
        <template id="school-card-template">
            <div class="card school-card">
                <div class="card-media">
                    <img src="" alt="" class="card-image">
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                </div>
            </div>
        </template>

        <!-- Category Selection View Template -->
        <template id="categories-view-template">
            <div class="view-container categories-view">
                <h2 class="view-title">Select a Category</h2>
                <div class="card-grid" id="categories-grid">
                    <div class="card category-card" data-category="sports">
                        <div class="card-media">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Sports Teams</h3>
                        </div>
                    </div>
                    <div class="card category-card" data-category="d1-athletes">
                        <div class="card-media">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">D1 Athletes</h3>
                        </div>
                    </div>
                    <div class="card category-card" data-category="pro-athletes">
                        <div class="card-media">
                            <i class="fas fa-medal"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Pro Athletes</h3>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Sports View Template -->
        <template id="sports-view-template">
            <div class="view-container sports-view">
                <h2 class="view-title">Select a Sport</h2>
                <div class="card-grid" id="sports-grid">
                    <!-- Sport cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Sport Card Template -->
        <template id="sport-card-template">
            <div class="card sport-card">
                <div class="card-media">
                    <i class="fas"></i>
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                </div>
            </div>
        </template>

        <!-- Years View Template -->
        <template id="years-view-template">
            <div class="view-container years-view">
                <h2 class="view-title">Select a Championship Year</h2>
                <div class="card-grid" id="years-grid">
                    <!-- Year cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Year Card Template -->
        <template id="year-card-template">
            <div class="card year-card">
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="card-subtitle"></p>
                </div>
            </div>
        </template>

        <!-- Team Detail View Template -->
        <template id="team-detail-template">
            <div class="view-container team-detail-view">
                <div class="team-header">
                    <h2 class="team-title"></h2>
                    <h3 class="team-achievement"></h3>
                </div>
                
                <div class="team-content">
                    <div class="team-media">
                        <img src="" alt="" class="team-photo">
                    </div>
                    
                    <div class="trophy-container">
                        <!-- Trophy content generated by JS -->
                    </div>
                </div>

                <div class="team-roster">
                    <h3>Team Roster</h3>
                    <div class="player-grid" id="roster-grid">
                        <!-- Player cards will be injected here -->
                    </div>
                </div>
            </div>
        </template>

        <!-- Trophy Model Container Template -->
        <template id="trophy-model-template">
            <h3>Championship Trophy</h3>
            <div class="trophy-model-container">
                <button class="expand-trophy-btn"><i class="fas fa-expand"></i></button>
                <model-viewer src="" alt="Championship Trophy Model" 
                              ar ar-modes="webxr scene-viewer quick-look" 
                              camera-controls touch-action="pan-y" 
                              auto-rotate 
                              shadow-intensity="1"
                              style="width: 100%; height: 100%; --mv-progress-mask: none;">
                    <div class="progress-bar hide" slot="progress-bar">
                        <div class="update-bar"></div>
                    </div>
                </model-viewer>
            </div>
        </template>
        
        <!-- Trophy Placeholder Template -->
        <template id="trophy-placeholder-template">
            <h3>Championship Trophy</h3>
            <div class="trophy-placeholder">
                <!-- SVG will be inserted here by JS -->
                <p>3D Trophy Model not available</p>
            </div>
        </template>

        <!-- Player Card Template -->
        <template id="player-card-template">
            <div class="card player-card">
                <div class="card-media">
                    <img src="" alt="" class="player-image">
                    <!-- SVG fallback injected here -->
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="player-position"></p>
                    <p class="player-number"></p>
                </div>
            </div>
        </template>

        <!-- Player Detail View Template -->
        <template id="player-detail-template">
            <div class="view-container player-detail-view">
                <div class="player-header">
                    <div class="player-media-carousel">
                        <div class="player-media-container">
                            <div class="player-media">
                                <img src="" alt="" class="player-photo">
                                 <!-- SVG fallback injected here -->
                            </div>
                            <div class="media-navigation">
                                <button class="media-nav-btn prev-btn"><i class="fas fa-chevron-left"></i></button>
                                <button class="media-nav-btn next-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div class="media-indicator"></div>
                    </div>
                    <div class="player-info">
                        <h2 class="player-name"></h2>
                        <div class="player-details">
                            <!-- Current team/sport info will be displayed first -->
                        </div>
                    </div>
                </div>
                
                <div class="player-teams">
                    <h3>Teams & Achievements</h3>
                    <div class="teams-container">
                        <!-- All teams will be injected here -->
                    </div>
                </div>
                
                <div class="player-stats-sections">
                    <!-- Stats for each sport/team will be injected here with headers -->
                </div>
            </div>
        </template>

        <!-- All Players View Template -->
        <template id="all-players-template">
            <div class="view-container all-players-view">
                <h2 class="view-title">All Players</h2>
                <div class="players-search-container">
                    <input type="text" id="players-filter" placeholder="Filter players...">
                </div>
                <div class="card-grid" id="all-players-grid">
                    <!-- Player cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Search Results Template -->
        <template id="search-results-template">
            <div class="view-container search-results-view">
                <h2 class="view-title">Search Results</h2>
                <div class="search-results-container">
                    <div class="search-results-section" id="players-results">
                        <h3>Players</h3>
                        <div class="card-grid players-results-grid">
                            <!-- Player results will be injected here -->
                        </div>
                    </div>
                    <div class="search-results-section" id="teams-results">
                        <h3>Teams</h3>
                        <div class="card-grid teams-results-grid">
                            <!-- Team results will be injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Athletes List View Template -->
        <template id="athletes-list-template">
            <div class="view-container athletes-list-view">
                <h2 class="view-title"></h2>
                <div class="athletes-grid" id="athletes-grid">
                    <!-- Athlete cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Athlete Card Template -->
        <template id="athlete-card-template">
            <div class="card athlete-card">
                <div class="card-media">
                    <img src="" alt="" class="athlete-image">
                    <!-- SVG fallback injected here -->
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="athlete-graduation"></p>
                    <p class="athlete-sport"></p>
                    <p class="athlete-affiliation"></p>
                </div>
            </div>
        </template>

        <!-- Athlete Detail View Template -->
        <template id="athlete-detail-template">
            <div class="view-container athlete-detail-view">
                <div class="athlete-header">
                    <div class="athlete-media">
                        <img src="" alt="" class="athlete-photo">
                         <!-- SVG fallback injected here -->
                    </div>
                    <div class="athlete-info">
                        <h2 class="athlete-name"></h2>
                        <p class="athlete-graduation"></p>
                        <p class="athlete-sport"></p>
                        <p class="athlete-affiliation"></p>
                    </div>
                </div>
                
                <div class="athlete-background">
                    <h3>Background</h3>
                    <div class="athlete-description">
                        <!-- Athlete info will be injected here -->
                    </div>
                </div>
            </div>
        </template>
    </main>

    <footer>
        <p>&copy; 2025 Saginaw Digital Trophy Case. All rights reserved.</p>
    </footer>

    <script src="app.js"></script>
</body>
</html>