<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saginaw Digital Trophy Case</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
    <!-- ðŸš€ Include model-viewer script -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    
    <!-- API Endpoint Detection -->
    <script>
        // Function to detect API Gateway URL based on environment
        function detectApiEndpoint() {
            // Manual override - uncomment and set this if auto-detection fails
            // window.API_ENDPOINT = "https://your-api-id.execute-api.region.amazonaws.com/Prod";
            
            // Check if we're running on AWS Amplify
            if (window.location.hostname.includes('amplifyapp.com')) {
                // First try to get the API URL from the Amplify outputs
                fetch('/.amplify-hosting/api-info.json')
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.api && data.api.api && data.api.api.RootUrl) {
                            window.API_ENDPOINT = data.api.api.RootUrl;
                            console.log('API Gateway URL detected:', window.API_ENDPOINT);
                        } else {
                            console.log('API Gateway URL not found in amplify outputs, checking healthcheck endpoint...');
                            // Try to auto-detect API URL by checking known routes
                            checkApiHealth();
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching API Gateway URL:', error);
                        checkApiHealth();
                    });
            } else {
                // If not on Amplify, use relative paths
                window.API_ENDPOINT = '';
                console.log('Using relative API paths');
            }
        }
        
        // Function to test API healthcheck
        function checkApiHealth() {
            // Test various potential API endpoints
            const hostname = window.location.hostname;
            const region = 'us-east-1'; // default region, change if needed
            
            // Generate potential API URLs based on app name and region
            const potentialApis = [
                '', // relative path as fallback
                `https://api.${hostname}`,
                `https://api-${hostname.split('.')[0]}.${region}.amazonaws.com/Prod`
            ];
            
            // Try each API endpoint until one works
            let apiFound = false;
            potentialApis.forEach((apiUrl, index) => {
                if (!apiFound) {
                    setTimeout(() => {
                        fetch(`${apiUrl}/api/healthcheck`)
                            .then(response => {
                                if (response.ok) {
                                    window.API_ENDPOINT = apiUrl;
                                    console.log('API endpoint found at:', apiUrl);
                                    apiFound = true;
                                }
                            })
                            .catch(() => {
                                console.log(`API endpoint not found at: ${apiUrl}`);
                            });
                    }, index * 100); // Stagger requests
                }
            });
        }
        
        // Run the detection on page load
        detectApiEndpoint();
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <svg class="header-logo" width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 0L25 10H35L27 16L30 26L20 20L10 26L13 16L5 10H15L20 0Z" fill="#EFBF04"/>
            </svg>
            <h1>Saginaw Digital Trophy Case</h1>
        </div>
        <nav id="main-nav">
            <button id="back-button" class="nav-button"><i class="fas fa-arrow-left"></i> Back</button>
            <button id="home-button" class="nav-button"><i class="fas fa-home"></i> Home</button>
        </nav>
    </header>

    <main>
        <!-- Loading Spinner -->
        <div id="loading-spinner">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Main Content Container -->
        <div id="content-container">
            <!-- Views will be dynamically injected here -->
        </div>

        <!-- School Selection View Template -->
        <template id="schools-view-template">
            <div class="view-container schools-view">
                <h2 class="view-title">Select a School</h2>
                <div class="card-grid" id="schools-grid">
                    <!-- School cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- School Card Template -->
        <template id="school-card-template">
            <div class="card school-card">
                <div class="card-media">
                    <img src="" alt="" class="card-image">
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                </div>
            </div>
        </template>

        <!-- Category Selection View Template -->
        <template id="categories-view-template">
            <div class="view-container categories-view">
                <h2 class="view-title">Select a Category</h2>
                <div class="card-grid" id="categories-grid">
                    <div class="card category-card" data-category="sports">
                        <div class="card-media">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Sports Teams</h3>
                        </div>
                    </div>
                    <div class="card category-card" data-category="d1-athletes">
                        <div class="card-media">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">D1 Athletes</h3>
                        </div>
                    </div>
                    <div class="card category-card" data-category="pro-athletes">
                        <div class="card-media">
                            <i class="fas fa-medal"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Pro Athletes</h3>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Sports View Template -->
        <template id="sports-view-template">
            <div class="view-container sports-view">
                <h2 class="view-title">Select a Sport</h2>
                <div class="card-grid" id="sports-grid">
                    <!-- Sport cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Sport Card Template -->
        <template id="sport-card-template">
            <div class="card sport-card">
                <div class="card-media">
                    <i class="fas"></i>
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                </div>
            </div>
        </template>

        <!-- Years View Template -->
        <template id="years-view-template">
            <div class="view-container years-view">
                <h2 class="view-title">Select a Championship Year</h2>
                <div class="card-grid" id="years-grid">
                    <!-- Year cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Year Card Template -->
        <template id="year-card-template">
            <div class="card year-card">
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="card-subtitle"></p>
                </div>
            </div>
        </template>

        <!-- Team Detail View Template -->
        <template id="team-detail-template">
            <div class="view-container team-detail-view">
                <div class="team-header">
                    <h2 class="team-title"></h2>
                    <h3 class="team-achievement"></h3>
                </div>
                
                <div class="team-content">
                    <div class="team-media">
                        <img src="" alt="" class="team-photo">
                    </div>
                    
                    <div class="trophy-container">
                        <!-- Trophy content generated by JS -->
                    </div>
                </div>

                <div class="team-roster">
                    <h3>Team Roster</h3>
                    <div class="player-grid" id="roster-grid">
                        <!-- Player cards will be injected here -->
                    </div>
                </div>
            </div>
        </template>

        <!-- Trophy Model Container Template -->
        <template id="trophy-model-template">
            <h3>Championship Trophy</h3>
            <div class="trophy-model-container">
                <button class="expand-trophy-btn"><i class="fas fa-expand"></i></button>
                <model-viewer src="" alt="Championship Trophy Model" 
                              ar ar-modes="webxr scene-viewer quick-look" 
                              camera-controls touch-action="pan-y" 
                              auto-rotate 
                              shadow-intensity="1"
                              style="width: 100%; height: 100%; --mv-progress-mask: none;">
                    <div class="progress-bar hide" slot="progress-bar">
                        <div class="update-bar"></div>
                    </div>
                </model-viewer>
            </div>
        </template>
        
        <!-- Trophy Placeholder Template -->
        <template id="trophy-placeholder-template">
            <h3>Championship Trophy</h3>
            <div class="trophy-placeholder">
                <!-- SVG will be inserted here by JS -->
                <p>3D Trophy Model not available</p>
            </div>
        </template>

        <!-- Player Card Template -->
        <template id="player-card-template">
            <div class="card player-card">
                <div class="card-media">
                    <img src="" alt="" class="player-image">
                    <!-- SVG fallback injected here -->
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="player-position"></p>
                    <p class="player-number"></p>
                </div>
            </div>
        </template>

        <!-- Player Detail View Template -->
        <template id="player-detail-template">
            <div class="view-container player-detail-view">
                <div class="player-header">
                    <div class="player-media">
                        <img src="" alt="" class="player-photo">
                         <!-- SVG fallback injected here -->
                    </div>
                    <div class="player-info">
                        <h2 class="player-name"></h2>
                        <p class="player-number-position"></p>
                        <p class="player-team"></p>
                    </div>
                </div>
                
                <div class="player-stats">
                    <h3>Statistics</h3>
                    <div class="stats-grid">
                        <!-- Stats will be injected here -->
                    </div>
                </div>
            </div>
        </template>

        <!-- Athletes List View Template -->
        <template id="athletes-list-template">
            <div class="view-container athletes-list-view">
                <h2 class="view-title"></h2>
                <div class="athletes-grid" id="athletes-grid">
                    <!-- Athlete cards will be injected here -->
                </div>
            </div>
        </template>

        <!-- Athlete Card Template -->
        <template id="athlete-card-template">
            <div class="card athlete-card">
                <div class="card-media">
                    <img src="" alt="" class="athlete-image">
                    <!-- SVG fallback injected here -->
                </div>
                <div class="card-content">
                    <h3 class="card-title"></h3>
                    <p class="athlete-graduation"></p>
                    <p class="athlete-sport"></p>
                    <p class="athlete-affiliation"></p>
                </div>
            </div>
        </template>

        <!-- Athlete Detail View Template -->
        <template id="athlete-detail-template">
            <div class="view-container athlete-detail-view">
                <div class="athlete-header">
                    <div class="athlete-media">
                        <img src="" alt="" class="athlete-photo">
                         <!-- SVG fallback injected here -->
                    </div>
                    <div class="athlete-info">
                        <h2 class="athlete-name"></h2>
                        <p class="athlete-graduation"></p>
                        <p class="athlete-sport"></p>
                        <p class="athlete-affiliation"></p>
                    </div>
                </div>
                
                <div class="athlete-background">
                    <h3>Background</h3>
                    <div class="athlete-description">
                        <!-- Athlete info will be injected here -->
                    </div>
                </div>
            </div>
        </template>
    </main>

    <footer>
        <p>&copy; 2025 Saginaw Digital Trophy Case. All rights reserved.</p>
    </footer>

    <script src="app.js"></script>
</body>
</html>